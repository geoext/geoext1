<!DOCTYPE html>
<html debug="true">
  <head>
    <script type="text/javascript" src="../../../../../ext/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="../../../../../ext/ext-all-debug.js"></script>

    <script type="text/javascript" src="../../../../../openlayers/lib/OpenLayers.js"></script>
    <script type="text/javascript" src="../../../../lib/GeoExt.js"></script>

    <!-- Define doc100 and doc110 that we will be testing below... here: -->
    <script type="text/javascript" src="WCSDescribeCoverageReader.js"></script>  

    <script type="text/javascript">
        function test_constructor(t) {
            t.plan(2);

            var reader = new GeoExt.data.WCSDescribeCoverageReader();

            var fields = reader.recordType.prototype.fields;
            // 1 test
            // Test the default items enumerated in GeoExt.data.WCSDescribeCoverageReader constructor 
            t.eq(fields.items.length, 7, 'number of default items is correct');

            var reader = new GeoExt.data.WCSDescribeCoverageReader({},[
                {name: 'foo'},
                {name: 'bar'}
            ]);

            var fields = reader.recordType.prototype.fields;

            //1 test
            t.ok(fields.items[0].name == 'foo' &&
                 fields.items[1].name == 'bar',
                 'field values set from configuration are correct');
        }

        function test_read_1_0_0(t) {
            t.plan(11);

            var reader = new GeoExt.data.WCSDescribeCoverageReader();

            var records = reader.read({responseXML : doc100});

            //1 test -- total number of records
            t.eq(records.totalRecords, 4, 'readRecords returns correct number of records');
            
            //2 tests -- testing the fields of a record
            var record = records.records[0];

            t.eq(record.data.name, 'ro_dsm', 'correct layer name');
            t.eq(record.data.title, 'RO DSM', 'correct layer title');
            t.eq(record.data.nativeCRS, 'EPSG:28992', 'correct nativeCRS');
            t.eq(record.data.nativeBoundingBox.CLASS_NAME, 'OpenLayers.Bounds', 'Got bounds object');
            t.eq(record.data.nativeBoundingBox.left, 91979, 'Got correct bounds left val');
            t.eq(record.data.supportedCRSs.length, 4, 'correct number of supportedCRSs');
            t.eq(record.data.supportedCRSs[1], 'EPSG:900913', 'correct supportedCRS value');
            t.eq(record.data.supportedFormats.length, 1, 'correct number of supportedFormats');
            t.eq(record.data.supportedFormats[0], 'GTiff', 'correct supportedFormat value');
            t.eq(record.data.gridOffsets, undefined, 'correct gridOffsets');       // Not supported in 1.0.0
        }
        
        function test_read_1_1_0(t) {
            t.plan(12);

            var reader = new GeoExt.data.WCSDescribeCoverageReader();

            var records = reader.read({responseXML : doc110});

            //1 test -- total number of records
            t.eq(records.totalRecords, 4, 'readRecords returns correct number of records');
            
            //2 tests -- testing the fields of a record
            var record = records.records[0];

            t.eq(record.data.name, 'ro_dsm', 'correct layer name');
            t.eq(record.data.title, 'RO DSM', 'correct layer title');
            t.eq(record.data.nativeCRS, 'urn:ogc:def:crs:EPSG::28992', 'correct nativeCRS');
            t.eq(record.data.nativeBoundingBox.CLASS_NAME, 'OpenLayers.Bounds', 'Got bounds object');
            t.eq(record.data.nativeBoundingBox.left, 91979, 'Got correct bounds left val');
            t.eq(record.data.supportedCRSs.length, 4, 'correct number of supportedCRSs');
            t.eq(record.data.supportedCRSs[1], 'urn:ogc:def:crs:EPSG::900913', 'correct supportedCRS value');
            t.eq(record.data.supportedFormats.length, 1, 'correct number of supportedFormats');
            t.eq(record.data.supportedFormats[0], 'image/tiff', 'correct supportedFormat value');
            t.eq(record.data.gridOffsets.x,  0.5, 'correct gridOffsets.x'); 
            t.eq(record.data.gridOffsets.y, -0.5, 'correct gridOffsets.y'); 
        }
    </script>
  <body>
    <div id="map"></div>
  </body>
</html>
